<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pip-Boy Life RPG vFINAL</title>
    
    <!-- STYLES & FONTS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <!-- REACT & LIBRARIES (UMD for easy browser usage) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- FIX: Prop-Types is often required by older UMD builds -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- FIX: Use Recharts v1.8.5 which has a reliable UMD Global export 'window.Recharts' -->
    <script src="https://unpkg.com/recharts@1.8.5/umd/Recharts.min.js"></script>
    
    <!-- BABEL (To compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Base overrides for the Pip-Boy aesthetic */
      body {
        background-color: #000000;
        color: #11d13b;
        font-family: 'VT323', monospace;
        overflow-y: auto;
        min-height: 100vh;
        padding-bottom: 200px;
        -webkit-font-smoothing: none;
      }
      
      ::-webkit-scrollbar { width: 12px; height: 12px; background: #000; }
      ::-webkit-scrollbar-thumb { background: #11d13b; border: 2px solid #000; }
      ::-webkit-scrollbar-track { background: #001100; }
      ::selection { background: #11d13b; color: #000000; }

      /* CRT Effects */
      .scanlines {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        background: linear-gradient(to bottom, rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
        background-size: 100% 4px; z-index: 9999; pointer-events: none; opacity: 0.15;
      }

      @keyframes flicker {
        0% { opacity: 0.97; } 5% { opacity: 0.95; } 10% { opacity: 0.9; }
        15% { opacity: 0.95; } 20% { opacity: 0.99; } 50% { opacity: 0.95; }
        55% { opacity: 0.93; } 60% { opacity: 0.9; } 80% { opacity: 0.98; } 100% { opacity: 1; }
      }

      .crt-flicker {
        animation: flicker 0.15s infinite; pointer-events: none;
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(17, 209, 59, 0.04); z-index: 9998;
      }

      .text-glow { text-shadow: 0 0 5px rgba(17, 209, 59, 0.7); }

      /* Inputs */
      input[type="checkbox"] {
        accent-color: #11d13b; cursor: pointer; width: 1.5rem; height: 1.5rem;
      }
      
      select, input[type="text"], input[type="number"] {
        background-color: #000; color: #11d13b; border: 1px solid #11d13b;
        font-family: 'VT323', monospace;
      }
      
      option { background-color: #000; color: #11d13b; }
      
      input[type=number]::-webkit-inner-spin-button, 
      input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; margin: 0; 
      }
      input[type=number] { -moz-appearance: textfield; }

      /* Mobile utilities */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scanlines"></div>
    <div class="crt-flicker"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo, useRef } = React;
      // Recharts v1.8.5 exports reliably to window.Recharts
      const { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar } = window.Recharts;

      // --- TYPES & CONSTANTS ---
      const CATEGORIES = ['STRENGTH', 'INTELLIGENCE', 'WEALTH', 'HEALTH', 'OTHER'];
      const STORAGE_KEY = 'PIPBOY_RPG_DATA_V1';

      // --- AUDIO SERVICE ---
      class AudioService {
        constructor() {
          this.ctx = null;
          this.masterGain = null;
        }

        init() {
          if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            this.masterGain = this.ctx.createGain();
            this.masterGain.gain.value = 0.3;
            this.masterGain.connect(this.ctx.destination);
          }
        }

        playHover() {
          this.init();
          if (!this.ctx || !this.masterGain) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = 'sine';
          osc.frequency.setValueAtTime(800, this.ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(1200, this.ctx.currentTime + 0.05);
          gain.gain.setValueAtTime(0.05, this.ctx.currentTime); // Lower volume for hover
          gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.05);
          osc.connect(gain);
          gain.connect(this.masterGain);
          osc.start();
          osc.stop(this.ctx.currentTime + 0.05);
        }

        playClick() {
          this.init();
          if (!this.ctx || !this.masterGain) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = 'square';
          osc.frequency.setValueAtTime(150, this.ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(40, this.ctx.currentTime + 0.1);
          gain.gain.setValueAtTime(0.2, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
          osc.connect(gain);
          gain.connect(this.masterGain);
          osc.start();
          osc.stop(this.ctx.currentTime + 0.1);
        }

        playSuccess() {
          this.init();
          if (!this.ctx || !this.masterGain) return;
          const now = this.ctx.currentTime;
          const notes = [440, 554, 659];
          notes.forEach((freq, i) => {
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = 'triangle';
            osc.frequency.value = freq;
            const startTime = now + i * 0.1;
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.05);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
            osc.connect(gain);
            gain.connect(this.masterGain);
            osc.start(startTime);
            osc.stop(startTime + 0.3);
          });
        }
      }
      const audioService = new AudioService();

      // --- COMPONENTS ---

      // 1. Tab Navigation
      const TABS = [
        { id: 'ADMIN', label: 'ADMIN' },
        { id: 'TRACKER', label: 'TRACKER' },
        { id: 'STATUS', label: 'STATUS' },
        { id: 'SYSTEM', label: 'SYSTEM' },
      ];

      const TabNavigation = ({ activeTab, setActiveTab }) => {
        return (
          <nav className="sticky top-0 z-50 bg-black border-b-4 border-[#11d13b] pt-2 pb-1 px-2 flex justify-between md:justify-start gap-2 overflow-x-auto no-scrollbar touch-pan-x">
            {TABS.map((tab) => (
              <button
                key={tab.id}
                onClick={() => {
                  audioService.playClick();
                  setActiveTab(tab.id);
                }}
                className={`
                  flex-shrink-0 px-4 py-3 text-lg md:text-xl font-bold uppercase tracking-widest transition-all duration-200
                  border-t-2 border-x-2 border-transparent rounded-t-lg
                  ${activeTab === tab.id 
                    ? 'bg-[#11d13b] text-black border-[#11d13b] shadow-[0_-5px_15px_rgba(17,209,59,0.3)]' 
                    : 'text-[#11d13b] hover:bg-[#11d13b] hover:text-black hover:bg-opacity-20'}
                `}
              >
                {tab.label}
              </button>
            ))}
          </nav>
        );
      };

      // 2. Admin Tab
      const AdminTab = ({ quests, addQuest, deleteQuest }) => {
        const [name, setName] = useState('');
        const [duration, setDuration] = useState('');
        const [categorySelection, setCategorySelection] = useState('STRENGTH');
        const [customCategory, setCustomCategory] = useState('');

        const handleAdd = () => {
          const durationNum = parseInt(duration);
          if (!name.trim() || isNaN(durationNum) || durationNum <= 0) return;
          
          const finalCategory = categorySelection === 'OTHER' 
            ? (customCategory.trim() || 'MISC') 
            : categorySelection;

          const newQuest = {
            id: crypto.randomUUID(),
            name,
            duration: durationNum,
            category: finalCategory,
            history: {}
          };

          addQuest(newQuest);
          audioService.playSuccess();
          setName('');
          setDuration('');
          setCategorySelection('STRENGTH');
          setCustomCategory('');
        };

        return (
          <div className="space-y-8 p-4 md:p-6 pb-20">
            <div className="border-2 border-[#11d13b] p-4 bg-black shadow-[0_0_10px_rgba(17,209,59,0.2)]">
              <h2 className="text-2xl mb-4 border-b border-[#11d13b] pb-2 text-glow">NEW ROUTINE PROTOCOL</h2>
              
              <div className="space-y-4">
                <div className="flex flex-col">
                  <label className="mb-1 text-sm opacity-80">ROUTINE NAME</label>
                  <input 
                    type="text" 
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                    className="bg-black border border-[#11d13b] p-3 text-xl focus:outline-none focus:ring-2 focus:ring-[#11d13b]"
                    placeholder="ENTER DESIGNATION..."
                  />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="flex flex-col">
                    <label className="mb-1 text-sm opacity-80">DURATION (MINS)</label>
                    <input 
                      type="number"
                      value={duration}
                      onChange={(e) => setDuration(e.target.value)}
                      min="1"
                      className="bg-black border border-[#11d13b] p-3 text-lg focus:outline-none placeholder-[#11d13b] placeholder-opacity-50"
                      placeholder="ENTER MINUTES..."
                    />
                  </div>

                  <div className="flex flex-col">
                    <label className="mb-1 text-sm opacity-80">CATEGORY</label>
                    <div className="flex gap-2">
                      <select 
                        value={categorySelection} 
                        onChange={(e) => setCategorySelection(e.target.value)}
                        className="bg-black border border-[#11d13b] p-3 text-lg focus:outline-none flex-1 appearance-none"
                      >
                        {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                      </select>
                      {categorySelection === 'OTHER' && (
                        <input 
                          type="text"
                          value={customCategory}
                          onChange={(e) => setCustomCategory(e.target.value)}
                          placeholder="TYPE..."
                          className="bg-black border border-[#11d13b] p-3 w-1/2 focus:outline-none animate-pulse"
                        />
                      )}
                    </div>
                  </div>
                </div>

                <button 
                  onClick={handleAdd}
                  onMouseEnter={() => audioService.playHover()}
                  className="w-full bg-[#11d13b] text-black font-bold py-4 text-xl hover:bg-opacity-90 active:scale-95 transition-transform shadow-[0_0_10px_#11d13b]"
                >
                  [ INITIATE PROTOCOL ]
                </button>
              </div>
            </div>

            <div className="space-y-4">
              <h3 className="text-xl border-b border-[#11d13b] inline-block pr-8">ACTIVE PROTOCOLS</h3>
              {quests.length === 0 && <p className="opacity-50 blink">NO DATA FOUND...</p>}
              
              <div className="grid gap-4">
                {quests.map(quest => (
                  <div key={quest.id} className="flex justify-between items-center border border-[#11d13b] p-4 bg-[#001100] hover:bg-[#11d13b] hover:bg-opacity-10 transition-colors">
                    <div>
                      <div className="font-bold text-lg">{quest.name}</div>
                      <div className="text-sm opacity-70 flex gap-2 mt-1">
                        <span className="bg-[#11d13b] text-black px-1 text-xs">{quest.category}</span>
                        <span>{quest.duration}m</span>
                      </div>
                    </div>
                    <button 
                      onClick={() => {
                        audioService.playClick();
                        deleteQuest(quest.id);
                      }}
                      className="text-[#11d13b] hover:bg-red-900 hover:text-red-500 p-3 border border-[#11d13b] hover:border-red-500 transition-all active:scale-90"
                      aria-label="Delete Protocol"
                    >
                      DELETE
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };

      // 3. Tracker Tab (Responsive: Cards for Mobile, Table for Desktop)
      const TrackerTab = ({ quests, toggleHistory }) => {
        const weekDates = useMemo(() => {
          const dates = [];
          const today = new Date();
          const day = today.getDay(); 
          const diff = today.getDate() - day + (day === 0 ? -6 : 1);
          const monday = new Date(today.setDate(diff));
          for (let i = 0; i < 7; i++) {
            const d = new Date(monday);
            d.setDate(monday.getDate() + i);
            dates.push(d);
          }
          return dates;
        }, []);

        const todayStr = new Date().toISOString().split('T')[0];

        const getDayStatus = (date) => {
          const dateStr = date.toISOString().split('T')[0];
          const isToday = dateStr === todayStr;
          return { dateStr, isToday, dayInitial: date.toLocaleDateString('en-US', { weekday: 'narrow' }) };
        };

        return (
          <div className="p-2 md:p-4 pb-20">
            
            {/* --- MOBILE VIEW: Cards --- */}
            <div className="md:hidden space-y-4">
              {quests.map(quest => {
                const todayStatus = getDayStatus(new Date());
                const isTodayDone = !!quest.history[todayStatus.dateStr];
                
                return (
                  <div key={quest.id} className="border border-[#11d13b] p-4 bg-black relative shadow-[0_0_8px_rgba(17,209,59,0.15)]">
                    
                    {/* Header */}
                    <div className="flex justify-between items-start mb-4">
                       <div>
                          <div className="text-2xl font-bold leading-none mb-1 text-glow">{quest.name}</div>
                          <div className="flex gap-2 text-xs">
                             <span className="bg-[#11d13b] text-black px-1">{quest.category}</span>
                             <span className="opacity-70">{quest.duration} MIN</span>
                          </div>
                       </div>
                       
                       {/* Today's Checkbox (Large) */}
                       <div className="flex flex-col items-center gap-1">
                          <label className="text-[10px] opacity-70">TODAY</label>
                          <input 
                              type="checkbox"
                              checked={isTodayDone}
                              onChange={() => {
                                audioService.playClick();
                                if (!isTodayDone) audioService.playSuccess();
                                toggleHistory(quest.id, todayStatus.dateStr);
                              }}
                              className="appearance-none border-2 border-[#11d13b] w-12 h-12 bg-black checked:bg-[#11d13b] checked:shadow-[0_0_15px_#11d13b] transition-all cursor-pointer"
                          />
                       </div>
                    </div>

                    {/* Weekly Visualization Strip */}
                    <div className="border-t border-[#11d13b] border-opacity-30 pt-3">
                       <div className="flex justify-between px-1">
                         {weekDates.map(date => {
                           const { dateStr, isToday, dayInitial } = getDayStatus(date);
                           const isDone = !!quest.history[dateStr];
                           
                           return (
                             <div key={dateStr} className="flex flex-col items-center gap-1">
                                <div className={`w-6 h-6 border border-[#11d13b] flex items-center justify-center transition-colors
                                  ${isDone ? 'bg-[#11d13b]' : 'bg-transparent'}
                                  ${isToday ? 'border-2 animate-pulse shadow-[0_0_5px_#11d13b]' : 'opacity-60'}
                                `}>
                                   {isDone && <span className="text-black text-xs font-bold">✓</span>}
                                </div>
                                <span className={`text-[10px] ${isToday ? 'text-[#11d13b] font-bold' : 'opacity-50'}`}>
                                  {dayInitial}
                                </span>
                             </div>
                           )
                         })}
                       </div>
                    </div>
                    
                  </div>
                );
              })}
              {quests.length === 0 && (
                <div className="text-center p-8 border border-[#11d13b] border-dashed opacity-50">
                  NO ROUTINES. ADD IN ADMIN.
                </div>
              )}
            </div>

            {/* --- DESKTOP VIEW: Table --- */}
            <div className="hidden md:block overflow-x-auto">
              <table className="w-full text-left border-collapse min-w-[600px]">
                <thead>
                  <tr>
                    <th className="p-3 border-b-2 border-[#11d13b] w-1/3 text-xl">ROUTINE</th>
                    {weekDates.map(date => {
                      const { dateStr, isToday } = getDayStatus(date);
                      const dayName = date.toLocaleDateString('en-US', { weekday: 'short' }).toUpperCase();
                      const dayNum = date.getDate();
                      return (
                        <th key={dateStr} className={`
                          p-2 text-center border-b-2 border-[#11d13b]
                          ${isToday ? 'border-t-2 bg-[#11d13b] bg-opacity-20' : ''}
                        `}>
                          <div className="text-xl font-bold">{dayName} {dayNum}</div>
                        </th>
                      );
                    })}
                  </tr>
                </thead>
                <tbody>
                  {quests.map(quest => (
                    <tr key={quest.id} className="border-b border-[#11d13b] border-opacity-30 hover:bg-[#11d13b] hover:bg-opacity-5 transition-colors">
                      <td className="p-4 font-bold">
                        <div className="text-lg">{quest.name}</div>
                        <div className="text-xs opacity-60 flex gap-2">
                          <span>{quest.duration} MIN</span>
                          <span>:: {quest.category}</span>
                        </div>
                      </td>
                      {weekDates.map(date => {
                        const { dateStr, isToday } = getDayStatus(date);
                        const isCompleted = !!quest.history[dateStr];
                        return (
                          <td key={dateStr} className="p-2 text-center">
                            <div className="flex justify-center">
                              <input 
                                type="checkbox"
                                checked={isCompleted}
                                disabled={!isToday}
                                onChange={() => {
                                  audioService.playClick();
                                  if (!isCompleted) audioService.playSuccess();
                                  toggleHistory(quest.id, dateStr);
                                }}
                                className={`
                                  appearance-none border-2 border-[#11d13b] w-8 h-8
                                  ${isCompleted ? 'bg-[#11d13b] shadow-[0_0_10px_#11d13b]' : 'bg-transparent'}
                                  ${!isToday ? 'opacity-30 cursor-not-allowed' : 'cursor-pointer hover:scale-110 transition-transform'}
                                `}
                              />
                            </div>
                          </td>
                        );
                      })}
                    </tr>
                  ))}
                  {quests.length === 0 && (
                    <tr>
                      <td colSpan={8} className="text-center p-8 opacity-50 text-xl">NO ROUTINES INITIALIZED. CHECK ADMIN CONSOLE.</td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        );
      };

      // 4. Stats Tab
      const StatsTab = ({ quests, totalXP, level }) => {
        const chartData = useMemo(() => {
          const stats = {};
          CATEGORIES.forEach(c => { if (c !== 'OTHER') stats[c] = 0; });
          stats['OTHER'] = 0;

          quests.forEach(q => {
            const completionCount = Object.keys(q.history).length;
            const totalQuestXP = completionCount * q.duration;
            const isStandard = CATEGORIES.includes(q.category);
            const key = isStandard && q.category !== 'OTHER' ? q.category : 'OTHER';
            stats[key] = (stats[key] || 0) + totalQuestXP;
          });

          return Object.entries(stats).map(([subject, A]) => ({
            subject,
            A,
            fullMark: Math.max(...Object.values(stats), 100) * 1.2
          }));
        }, [quests]);

        return (
          <div className="p-4 md:p-6 space-y-6 md:space-y-8 bg-black pb-20">
            <div className="grid grid-cols-2 gap-4">
              <div className="border-2 border-[#11d13b] p-4 text-center bg-black shadow-[0_0_10px_rgba(17,209,59,0.2)]">
                <div className="text-xs md:text-sm opacity-70 mb-1">CURRENT LEVEL</div>
                <div className="text-4xl md:text-6xl font-bold text-glow">{level}</div>
              </div>
              <div className="border-2 border-[#11d13b] p-4 text-center bg-black shadow-[0_0_10px_rgba(17,209,59,0.2)]">
                <div className="text-xs md:text-sm opacity-70 mb-1">TOTAL XP</div>
                <div className="text-4xl md:text-6xl font-bold text-glow">{totalXP}</div>
              </div>
            </div>

            <div className="border border-[#11d13b] p-2 md:p-4 bg-black relative min-h-[350px] md:min-h-[400px] shadow-[inset_0_0_20px_rgba(17,209,59,0.1)]">
              <h3 className="absolute top-2 left-2 text-sm border-b border-[#11d13b]">S.P.E.C.I.A.L. STATUS</h3>
              <div className="h-[300px] md:h-[350px] w-full mt-8 md:mt-6">
                <ResponsiveContainer width="100%" height="100%">
                  <RadarChart cx="50%" cy="50%" outerRadius="75%" data={chartData}>
                    <PolarGrid stroke="#11d13b" strokeOpacity={0.3} />
                    <PolarAngleAxis dataKey="subject" tick={{ fill: '#11d13b', fontSize: 10, fontFamily: 'VT323' }} />
                    <PolarRadiusAxis angle={30} domain={[0, 'auto']} tick={false} axisLine={false} />
                    <Radar name="Stats" dataKey="A" stroke="#11d13b" strokeWidth={3} fill="#11d13b" fillOpacity={0.4} />
                  </RadarChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="border-t border-[#11d13b] pt-8 mt-12">
              <button
                onClick={() => {
                  audioService.playClick();
                  window.resetStatus();
                }}
                className="w-full py-4 border-2 border-red-900 text-red-700 hover:bg-red-900 hover:text-black transition-colors font-bold text-lg md:text-xl tracking-widest uppercase opacity-80 hover:opacity-100"
              >
                [ RESET OVERSEER STATUS ]
              </button>
            </div>
          </div>
        );
      };

      // 5. System Tab
      const SystemTab = ({ state, loadState }) => {
        const fileInputRef = useRef(null);

        const handleExport = () => {
          audioService.playClick();
          const dataStr = JSON.stringify(state, null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `PIPBOY_DATA_${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        const handleImportClick = () => {
          audioService.playClick();
          fileInputRef.current?.click();
        };

        const handleFileChange = (e) => {
          const file = e.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const json = JSON.parse(event.target?.result);
              if (json.quests && typeof json.totalXP === 'number') {
                loadState(json);
                audioService.playSuccess();
                alert('HOLOTAPE LOADED SUCCESSFULLY. SYSTEM RESTARTING...');
                window.location.reload();
              } else {
                throw new Error('Invalid format');
              }
            } catch (err) {
              alert('ERROR: HOLOTAPE CORRUPTED.');
            }
          };
          reader.readAsText(file);
        };

        return (
          <div className="p-4 flex flex-col items-center justify-center h-[60vh] space-y-8">
            <div className="text-center space-y-4">
              <h2 className="text-3xl text-glow border-b-2 border-[#11d13b] inline-block pb-1">DATA MANAGEMENT</h2>
              <p className="opacity-70 text-sm max-w-xs mx-auto leading-relaxed">
                ENSURE REGULAR BACKUPS TO PREVENT DATA LOSS DUE TO RADIATION OR SYSTEM FAILURE.
              </p>
            </div>

            <div className="w-full max-w-sm space-y-4">
              <button
                onClick={handleExport}
                onMouseEnter={() => audioService.playHover()}
                className="w-full border-2 border-[#11d13b] py-5 text-xl hover:bg-[#11d13b] hover:text-black transition-all flex justify-center items-center gap-3 group shadow-[0_0_10px_rgba(17,209,59,0.1)]"
              >
                <span className="animate-pulse group-hover:animate-none">▼</span> 
                EXPORT HOLOTAPE
              </button>

              <div className="relative">
                <input
                  type="file"
                  ref={fileInputRef}
                  onChange={handleFileChange}
                  className="hidden"
                  accept=".json"
                />
                <button
                  onClick={handleImportClick}
                  onMouseEnter={() => audioService.playHover()}
                  className="w-full border-2 border-[#11d13b] py-5 text-xl hover:bg-[#11d13b] hover:text-black transition-all flex justify-center items-center gap-3 group shadow-[0_0_10px_rgba(17,209,59,0.1)]"
                >
                   <span className="animate-pulse group-hover:animate-none">▲</span>
                   LOAD HOLOTAPE
                </button>
              </div>
            </div>
          </div>
        );
      };

      // --- MAIN APP COMPONENT ---
      const INITIAL_STATE = { quests: [], totalXP: 0, level: 1 };

      const App = () => {
        const [activeTab, setActiveTab] = useState('TRACKER');
        const [state, setState] = useState(INITIAL_STATE);
        const [loaded, setLoaded] = useState(false);

        useEffect(() => {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved) {
            try { setState(JSON.parse(saved)); } catch (e) { console.error("Data corruption"); }
          }
          setLoaded(true);
        }, []);

        useEffect(() => {
          if (loaded) { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
        }, [state, loaded]);

        useEffect(() => {
          window.resetStatus = function() {
            if (!confirm("WARNING: WIPE ALL XP AND HISTORY?")) return;
            const wipedQuests = state.quests.map(q => ({ ...q, history: {} }));
            const cleanState = { quests: wipedQuests, totalXP: 0, level: 1 };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(cleanState));
            window.location.reload();
          };
        }, [state]);

        const addQuest = (quest) => {
          setState(prev => ({ ...prev, quests: [...prev.quests, quest] }));
        };

        const deleteQuest = (id) => {
          setState(prev => ({
            ...prev,
            quests: prev.quests.filter(q => q.id !== id)
          }));
        };

        const toggleHistory = (questId, date) => {
          setState(prev => {
            const quests = prev.quests.map(q => {
              if (q.id !== questId) return q;
              const newHistory = { ...q.history };
              if (newHistory[date]) delete newHistory[date];
              else newHistory[date] = true;
              return { ...q, history: newHistory };
            });

            let newTotalXP = 0;
            quests.forEach(q => {
              const completions = Object.keys(q.history).length;
              newTotalXP += completions * q.duration;
            });
            const newLevel = Math.floor(newTotalXP / 100) + 1;

            return { quests, totalXP: newTotalXP, level: newLevel };
          });
        };

        const loadExternalState = (newState) => {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(newState));
        };

        if (!loaded) return <div className="text-[#11d13b] p-10 animate-pulse text-2xl text-center mt-20">INITIALIZING PIP-BOY OS...</div>;

        return (
          <div className="max-w-4xl mx-auto min-h-screen bg-black text-[#11d13b] font-mono pb-[200px] relative z-10 selection:bg-[#11d13b] selection:text-black">
            
            {/* Header */}
            <div className="p-4 border-b-4 border-[#11d13b] mb-2 flex justify-between items-end bg-black sticky top-0 z-40">
              <div>
                <h1 className="text-3xl md:text-5xl font-bold text-glow tracking-tighter leading-none">PIP-BOY LIFE</h1>
                <div className="text-[10px] md:text-sm opacity-70 tracking-widest mt-1">ROBCO INDUSTRIES (TM) TERM-LINK</div>
              </div>
              <div className="text-right">
                <div className="text-[10px] md:text-xs opacity-80">OVERSEER LVL</div>
                <div className="text-2xl md:text-4xl font-bold leading-none">{state.level}</div>
              </div>
            </div>

            <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

            <main className="mt-4 md:mt-6 border-x-0 md:border-x-2 border-[#11d13b] min-h-[500px] shadow-[0_0_20px_rgba(17,209,59,0.1)] mx-0 md:mx-2 bg-black">
              {activeTab === 'ADMIN' && <AdminTab quests={state.quests} addQuest={addQuest} deleteQuest={deleteQuest} />}
              {activeTab === 'TRACKER' && <TrackerTab quests={state.quests} toggleHistory={toggleHistory} />}
              {activeTab === 'STATUS' && <StatsTab quests={state.quests} totalXP={state.totalXP} level={state.level} />}
              {activeTab === 'SYSTEM' && <SystemTab state={state} loadState={loadExternalState} />}
            </main>

            <footer className="mt-8 mb-8 text-center opacity-50 text-[10px] md:text-xs">
              <p>VAULT-TEC REMINDS YOU: DISCIPLINE IS KEY TO SURVIVAL.</p>
              <p className="mt-1">v 1.0.2 // UNIFIED_BUILD</p>
            </footer>
          </div>
        );
      };

      // --- MOUNT ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
</body>
</html>